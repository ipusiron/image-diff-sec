<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆ</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        canvas { border: 1px solid #ccc; margin: 10px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .download-links { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>ã‚·ãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
    <p>ImageDiffSecã®å‹•ä½œç¢ºèªç”¨ã®å˜ç´”ãªãƒ†ã‚¹ãƒˆç”»åƒã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

    <div>
        <h2>ãƒ†ã‚¹ãƒˆ1: å®Œå…¨ä¸€è‡´ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="generateIdenticalTest()">åŒä¸€ç”»åƒã‚’ç”Ÿæˆ</button>
        <br><br>
        
        <div>
            <strong>ç”»åƒA (300x300px):</strong><br>
            <canvas id="test1-a" width="300" height="300"></canvas>
            <div class="download-links">
                <a id="download-test1-a" download="identical_a_300x300.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
        
        <div>
            <strong>ç”»åƒB (200x200px - Aã‹ã‚‰åˆ‡ã‚Šå‡ºã—):</strong><br>
            <canvas id="test1-b" width="200" height="200"></canvas>
            <div class="download-links">
                <a id="download-test1-b" download="identical_b_200x200.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
    </div>

    <div>
        <h2>ãƒ†ã‚¹ãƒˆ2: ã‚ãšã‹ãªå·®åˆ†ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="generateMinorDiffTest()">å¾®å°å·®åˆ†ç”»åƒã‚’ç”Ÿæˆ</button>
        <br><br>
        
        <div>
            <strong>ç”»åƒA (300x300px):</strong><br>
            <canvas id="test2-a" width="300" height="300"></canvas>
            <div class="download-links">
                <a id="download-test2-a" download="minor_diff_a_300x300.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
        
        <div>
            <strong>ç”»åƒB (200x200px - 1ãƒ”ã‚¯ã‚»ãƒ«å¤‰æ›´):</strong><br>
            <canvas id="test2-b" width="200" height="200"></canvas>
            <div class="download-links">
                <a id="download-test2-b" download="minor_diff_b_200x200.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
    </div>

    <div>
        <h2>ãƒ†ã‚¹ãƒˆ3: QRã‚³ãƒ¼ãƒ‰é¢¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="generateQRLikeTest()">QRã‚³ãƒ¼ãƒ‰é¢¨ç”»åƒã‚’ç”Ÿæˆ</button>
        <br><br>
        
        <div>
            <strong>ç”»åƒA (400x400px):</strong><br>
            <canvas id="test3-a" width="400" height="400"></canvas>
            <div class="download-links">
                <a id="download-test3-a" download="qr_like_a_400x400.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
        
        <div>
            <strong>ç”»åƒB (200x200px - å®Œå…¨ä¸€è‡´):</strong><br>
            <canvas id="test3-b" width="200" height="200"></canvas>
            <div class="download-links">
                <a id="download-test3-b" download="qr_like_b_200x200.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆ1: å®Œå…¨ä¸€è‡´ãƒ†ã‚¹ãƒˆ
        function generateIdenticalTest() {
            console.log('å®Œå…¨ä¸€è‡´ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆé–‹å§‹');
            
            // ç”»åƒA (300x300)
            const canvasA = document.getElementById('test1-a');
            const ctxA = canvasA.getContext('2d');
            ctxA.imageSmoothingEnabled = false;
            
            // ç™½èƒŒæ™¯
            ctxA.fillStyle = '#ffffff';
            ctxA.fillRect(0, 0, 300, 300);
            
            // ä¸­å¤®ã«200x200ã®é ˜åŸŸã‚’ä½œæˆ
            const centerX = 50; // (300-200)/2
            const centerY = 50;
            
            // ãƒã‚§ãƒƒã‚«ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æç”»
            const cellSize = 20;
            for (let y = 0; y < 200; y += cellSize) {
                for (let x = 0; x < 200; x += cellSize) {
                    const isBlack = ((x / cellSize) + (y / cellSize)) % 2 === 0;
                    ctxA.fillStyle = isBlack ? '#000000' : '#ffffff';
                    ctxA.fillRect(centerX + x, centerY + y, cellSize, cellSize);
                }
            }
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®š
            canvasA.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                document.getElementById('download-test1-a').href = url;
            });
            
            // ç”»åƒB (200x200) - Aã‹ã‚‰å®Œå…¨ã«ã‚³ãƒ”ãƒ¼
            const canvasB = document.getElementById('test1-b');
            const ctxB = canvasB.getContext('2d');
            ctxB.imageSmoothingEnabled = false;
            
            // Aã®ä¸­å¤®éƒ¨åˆ†(200x200)ã‚’å®Œå…¨ã«ã‚³ãƒ”ãƒ¼
            const imageData = ctxA.getImageData(centerX, centerY, 200, 200);
            ctxB.putImageData(imageData, 0, 0);
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®š
            canvasB.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                document.getElementById('download-test1-b').href = url;
            });
            
            console.log('å®Œå…¨ä¸€è‡´ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆå®Œäº†');
            console.log('æœŸå¾…çµæœ: å·®åˆ†ç‡ 0%');
        }
        
        // ãƒ†ã‚¹ãƒˆ2: ã‚ãšã‹ãªå·®åˆ†ãƒ†ã‚¹ãƒˆ
        function generateMinorDiffTest() {
            console.log('å¾®å°å·®åˆ†ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆé–‹å§‹');
            
            // ç”»åƒA (300x300)
            const canvasA = document.getElementById('test2-a');
            const ctxA = canvasA.getContext('2d');
            ctxA.imageSmoothingEnabled = false;
            
            // ç™½èƒŒæ™¯
            ctxA.fillStyle = '#ffffff';
            ctxA.fillRect(0, 0, 300, 300);
            
            // ä¸­å¤®ã«200x200ã®é ˜åŸŸã‚’ä½œæˆ
            const centerX = 50;
            const centerY = 50;
            
            // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æç”»ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãªã—ï¼‰
            ctxA.fillStyle = '#cccccc';
            ctxA.fillRect(centerX, centerY, 200, 200);
            ctxA.fillStyle = '#000000';
            ctxA.fillRect(centerX + 50, centerY + 50, 100, 100);
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®š
            canvasA.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                document.getElementById('download-test2-a').href = url;
            });
            
            // ç”»åƒB (200x200) - Aã‹ã‚‰ä¸€éƒ¨å¤‰æ›´ã—ã¦ã‚³ãƒ”ãƒ¼
            const canvasB = document.getElementById('test2-b');
            const ctxB = canvasB.getContext('2d');
            ctxB.imageSmoothingEnabled = false;
            
            // Aã®ä¸­å¤®éƒ¨åˆ†(200x200)ã‚’ã‚³ãƒ”ãƒ¼
            const imageData = ctxA.getImageData(centerX, centerY, 200, 200);
            ctxB.putImageData(imageData, 0, 0);
            
            // 1ãƒ”ã‚¯ã‚»ãƒ«ã ã‘å¤‰æ›´
            ctxB.fillStyle = '#ff0000';
            ctxB.fillRect(100, 100, 1, 1);
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®š
            canvasB.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                document.getElementById('download-test2-b').href = url;
            });
            
            console.log('å¾®å°å·®åˆ†ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆå®Œäº†');
            console.log('æœŸå¾…çµæœ: å·®åˆ†ç‡ 0.0025% (1ãƒ”ã‚¯ã‚»ãƒ« / 40000ãƒ”ã‚¯ã‚»ãƒ«)');
        }
        
        // ãƒ†ã‚¹ãƒˆ3: QRã‚³ãƒ¼ãƒ‰é¢¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ
        function generateQRLikeTest() {
            console.log('QRã‚³ãƒ¼ãƒ‰é¢¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆé–‹å§‹');
            
            // 400x400ã®ç”»åƒA
            const canvasA = document.getElementById('test3-a');
            const ctxA = canvasA.getContext('2d');
            ctxA.imageSmoothingEnabled = false;
            
            // ç™½èƒŒæ™¯
            ctxA.fillStyle = '#ffffff';
            ctxA.fillRect(0, 0, 400, 400);
            
            // ä¸­å¤®ã«200x200ã®QRã‚³ãƒ¼ãƒ‰é¢¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œæˆ
            const centerX = 100; // (400-200)/2
            const centerY = 100;
            
            // æ±ºå®šè«–çš„ãªQRã‚³ãƒ¼ãƒ‰é¢¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æç”»
            const cellSize = 8; // 200/25 = 8px per cell
            const pattern = [
                [1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1,0,1,1,0,1,1,0,1,0,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,0,1,1,1,0,0,1,0,1,1,1,0,1],
                [1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1],
                [1,0,1,1,1,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1],
                [0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0],
                [1,1,0,1,1,0,1,1,0,1,1,1,0,1,1,0,1,1,0,1,1],
                [0,1,1,0,0,1,0,0,1,0,1,0,1,0,0,1,1,0,0,1,0],
                [1,0,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,0,1],
                [0,1,0,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,1,0],
                [1,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,0,1,1,1,1],
                [0,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0],
                [1,1,1,1,1,1,1,0,0,1,0,1,0,0,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,0,0,0,0,0,0,1,0,1,1,1,0,1],
                [1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1],
                [1,0,1,1,1,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1]
            ];
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æç”»
            ctxA.fillStyle = '#000000';
            for (let row = 0; row < pattern.length; row++) {
                for (let col = 0; col < pattern[row].length; col++) {
                    if (pattern[row][col] === 1) {
                        ctxA.fillRect(centerX + col * cellSize, centerY + row * cellSize, cellSize, cellSize);
                    }
                }
            }
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®š
            canvasA.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                document.getElementById('download-test3-a').href = url;
            });
            
            // 200x200ã®ç”»åƒB - Aã‹ã‚‰å®Œå…¨ã«ã‚³ãƒ”ãƒ¼
            const canvasB = document.getElementById('test3-b');
            const ctxB = canvasB.getContext('2d');
            ctxB.imageSmoothingEnabled = false;
            
            // Aã®ä¸­å¤®éƒ¨åˆ†(200x200)ã‚’å®Œå…¨ã«ã‚³ãƒ”ãƒ¼
            const imageData = ctxA.getImageData(centerX, centerY, 200, 200);
            ctxB.putImageData(imageData, 0, 0);
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®š
            canvasB.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                document.getElementById('download-test3-b').href = url;
            });
            
            console.log('QRã‚³ãƒ¼ãƒ‰é¢¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆå®Œäº†');
            console.log('æœŸå¾…çµæœ: å·®åˆ†ç‡ 0% (å®Œå…¨ä¸€è‡´)');
        }
        
        // åˆæœŸç”Ÿæˆ
        window.addEventListener('load', function() {
            setTimeout(() => {
                generateIdenticalTest();
                generateMinorDiffTest();
                generateQRLikeTest();
            }, 500);
        });
    </script>
</body>
</html>