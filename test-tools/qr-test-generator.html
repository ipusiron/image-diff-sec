<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRã‚³ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .generator-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        canvas {
            border: 1px solid #ccc;
            margin: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .download-links {
            margin-top: 10px;
        }
        .scenario {
            background-color: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <h1>QRã‚³ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
    <p>ImageDiffSecã®ç•°ãªã‚‹ã‚µã‚¤ã‚ºç”»åƒæ¯”è¼ƒæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ç”»åƒã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

    <!-- ã‚·ãƒŠãƒªã‚ª1: ãƒ•ãƒ«ã‚µã‚¤ã‚ºã¨ãƒˆãƒªãƒŸãƒ³ã‚° -->
    <div class="generator-section">
        <h2>ã‚·ãƒŠãƒªã‚ª1: ãƒ•ãƒ«ã‚µã‚¤ã‚º vs ãƒˆãƒªãƒŸãƒ³ã‚°ç‰ˆ</h2>
        <div class="scenario">
            <strong>ç”¨é€”:</strong> ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®å…¨ä½“ç”»åƒã¨ã€QRã‚³ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’ãƒˆãƒªãƒŸãƒ³ã‚°ã—ãŸç”»åƒã®æ¯”è¼ƒ<br>
            <strong>æœŸå¾…çµæœ:</strong> QRã‚³ãƒ¼ãƒ‰éƒ¨åˆ†ãŒå®Œå…¨ä¸€è‡´ã¨ã—ã¦æ¤œå‡ºã•ã‚Œã‚‹
        </div>
        
        <label>QRã‚³ãƒ¼ãƒ‰å†…å®¹:</label>
        <input type="text" id="scenario1-text" value="https://akademeia.info/" style="width: 300px;">
        <br><br>
        
        <button onclick="generateScenario1()">ç”»åƒã‚’ç”Ÿæˆ</button>
        <br><br>
        
        <div>
            <strong>å¤§ããªç”»åƒ (400x400px):</strong><br>
            <canvas id="scenario1-large" width="400" height="400"></canvas>
            <div class="download-links">
                <a id="download-scenario1-large" download="qr_full_400x400.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
        
        <div>
            <strong>å°ã•ãªç”»åƒ (QRéƒ¨åˆ†ã®ã¿ 200x200px):</strong><br>
            <canvas id="scenario1-small" width="200" height="200"></canvas>
            <div class="download-links">
                <a id="download-scenario1-small" download="qr_cropped_200x200.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
    </div>

    <!-- ã‚·ãƒŠãƒªã‚ª2: èƒŒæ™¯é•ã„ -->
    <div class="generator-section">
        <h2>ã‚·ãƒŠãƒªã‚ª2: åŒä¸€QRã‚³ãƒ¼ãƒ‰ã€ç•°ãªã‚‹èƒŒæ™¯ã‚µã‚¤ã‚º</h2>
        <div class="scenario">
            <strong>ç”¨é€”:</strong> åŒã˜QRã‚³ãƒ¼ãƒ‰ãŒç•°ãªã‚‹ã‚µã‚¤ã‚ºã®èƒŒæ™¯ã«é…ç½®ã•ã‚ŒãŸç”»åƒã®æ¯”è¼ƒ<br>
            <strong>æœŸå¾…çµæœ:</strong> QRã‚³ãƒ¼ãƒ‰éƒ¨åˆ†ã¯ä¸€è‡´ã€èƒŒæ™¯éƒ¨åˆ†ã¯ç„¡è¦–ã•ã‚Œã‚‹
        </div>
        
        <label>QRã‚³ãƒ¼ãƒ‰å†…å®¹:</label>
        <input type="text" id="scenario2-text" value="https://github.com/ipusiron/image-diff-sec" style="width: 300px;">
        <br><br>
        
        <button onclick="generateScenario2()">ç”»åƒã‚’ç”Ÿæˆ</button>
        <br><br>
        
        <div>
            <strong>èƒŒæ™¯å¤§ (500x300px):</strong><br>
            <canvas id="scenario2-large" width="500" height="300"></canvas>
            <div class="download-links">
                <a id="download-scenario2-large" download="qr_bg_large_500x300.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
        
        <div>
            <strong>èƒŒæ™¯å° (300x200px):</strong><br>
            <canvas id="scenario2-small" width="300" height="200"></canvas>
            <div class="download-links">
                <a id="download-scenario2-small" download="qr_bg_small_300x200.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
    </div>

    <!-- ã‚·ãƒŠãƒªã‚ª3: æ”¹ã–ã‚“æ¤œå‡º -->
    <div class="generator-section">
        <h2>ã‚·ãƒŠãƒªã‚ª3: æ”¹ã–ã‚“æ¤œå‡ºãƒ†ã‚¹ãƒˆ</h2>
        <div class="scenario">
            <strong>ç”¨é€”:</strong> æ­£å¸¸ãªQRã‚³ãƒ¼ãƒ‰ã¨æ”¹ã–ã‚“ã•ã‚ŒãŸQRã‚³ãƒ¼ãƒ‰ã®æ¯”è¼ƒï¼ˆã‚µã‚¤ã‚ºé•ã„ï¼‰<br>
            <strong>æœŸå¾…çµæœ:</strong> URLã®é•ã„ã«ã‚ˆã‚‹å·®åˆ†ãŒæ¤œå‡ºã•ã‚Œã‚‹
        </div>
        
        <label>æ­£å¸¸ãªURL:</label>
        <input type="text" id="scenario3-legit" value="https://test.com" style="width: 300px;">
        <br>
        <label>æ”¹ã–ã‚“URL:</label>
        <input type="text" id="scenario3-fake" value="https://test.c0m" style="width: 300px;">
        <br><br>
        
        <button onclick="generateScenario3()">ç”»åƒã‚’ç”Ÿæˆ</button>
        <br><br>
        
        <div>
            <strong>æ­£å¸¸ç‰ˆ (400x300px):</strong><br>
            <canvas id="scenario3-legit-canvas" width="400" height="300"></canvas>
            <div class="download-links">
                <a id="download-scenario3-legit" download="qr_legit_400x300.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
        
        <div>
            <strong>æ”¹ã–ã‚“ç‰ˆ (250x200px):</strong><br>
            <canvas id="scenario3-fake-canvas" width="250" height="200"></canvas>
            <div class="download-links">
                <a id="download-scenario3-fake" download="qr_fake_250x200.png">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            </div>
        </div>
    </div>

    <script>
        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®åŸºæœ¬é–¢æ•°ï¼ˆæ•´æ•°ãƒ”ã‚¯ã‚»ãƒ«ç‰ˆï¼‰
        function createQRCode(text, targetSize) {
            try {
                console.log('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆé–‹å§‹:', text, 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚º:', targetSize);
                
                // ã‚¨ãƒ©ãƒ¼è¨‚æ­£ãƒ¬ãƒ™ãƒ«ã‚’ä¸‹ã’ã¦ç”Ÿæˆã‚’ç¢ºå®Ÿã«ã™ã‚‹
                let qr;
                try {
                    qr = qrcode(0, 'L'); // ã‚¨ãƒ©ãƒ¼è¨‚æ­£ãƒ¬ãƒ™ãƒ«ã‚’æœ€ä½ã«
                    qr.addData(text);
                    qr.make();
                } catch (firstError) {
                    console.log('ã‚¨ãƒ©ãƒ¼è¨‚æ­£ãƒ¬ãƒ™ãƒ«Lã§å¤±æ•—ã€å†è©¦è¡Œ...');
                    // è‡ªå‹•ã‚µã‚¤ã‚ºèª¿æ•´ã§å†è©¦è¡Œ
                    qr = qrcode(4, 'L'); // ã‚¿ã‚¤ãƒ—ã‚’å›ºå®š
                    qr.addData(text);
                    qr.make();
                }
                
                const moduleCount = qr.getModuleCount();
                
                // å›ºå®šã‚µã‚¤ã‚ºã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä½œæˆ
                const canvas = document.createElement('canvas');
                canvas.width = targetSize;
                canvas.height = targetSize;
                const ctx = canvas.getContext('2d');
                
                // ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’ç„¡åŠ¹ã«ã—ã¦å®Œå…¨ãªãƒ”ã‚¯ã‚»ãƒ«ä¸€è‡´ã‚’ä¿è¨¼
                ctx.imageSmoothingEnabled = false;
                
                // ç™½èƒŒæ™¯
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, targetSize, targetSize);
                
                // æ•´æ•°ãƒ”ã‚¯ã‚»ãƒ«ã§ã®è¨ˆç®—ï¼ˆå°æ•°ç‚¹ã‚’é¿ã‘ã‚‹ï¼‰
                const maxQRSize = Math.floor(targetSize * 0.8); // 80%ã®ã‚µã‚¤ã‚º
                const cellSize = Math.floor(maxQRSize / moduleCount);
                const qrSize = cellSize * moduleCount;
                const offsetX = Math.floor((targetSize - qrSize) / 2);
                const offsetY = Math.floor((targetSize - qrSize) / 2);
                
                console.log('QRã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºè¨ˆç®—:', moduleCount, 'x', moduleCount, 'ã‚»ãƒ«ã‚µã‚¤ã‚º:', cellSize, 'ã‚ªãƒ•ã‚»ãƒƒãƒˆ:', offsetX, offsetY);
                
                // QRã‚³ãƒ¼ãƒ‰æç”»ï¼ˆæ•´æ•°ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ï¼‰
                ctx.fillStyle = '#000000';
                for (let row = 0; row < moduleCount; row++) {
                    for (let col = 0; col < moduleCount; col++) {
                        if (qr.isDark(row, col)) {
                            const x = offsetX + col * cellSize;
                            const y = offsetY + row * cellSize;
                            ctx.fillRect(x, y, cellSize, cellSize);
                        }
                    }
                }
                
                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«ä¿å­˜
                canvas._debugInfo = {
                    moduleCount,
                    maxQRSize,
                    cellSize,
                    qrSize,
                    offsetX,
                    offsetY,
                    targetSize
                };
                
                console.log('QRã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸ - å›ºå®šã‚µã‚¤ã‚º:', targetSize);
                return canvas;
            } catch (error) {
                console.error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                console.error('å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:', text);
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
                const canvas = document.createElement('canvas');
                canvas.width = targetSize;
                canvas.height = targetSize;
                const ctx = canvas.getContext('2d');
                
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, targetSize, targetSize);
                ctx.fillStyle = '#000000';
                ctx.font = '12px Arial';
                ctx.fillText('QRç”Ÿæˆå¤±æ•—', 10, 20);
                ctx.fillText(text.substring(0, 20), 10, 40);
                
                return canvas;
            }
        }

        // ã‚·ãƒŠãƒªã‚ª1: ãƒ•ãƒ«ã‚µã‚¤ã‚ºã¨ãƒˆãƒªãƒŸãƒ³ã‚°
        function generateScenario1() {
            const text = document.getElementById('scenario1-text').value;
            
            try {
                // QRã‚³ãƒ¼ãƒ‰ã‚’ä¸€åº¦ã ã‘ç”Ÿæˆ
                const qrCanvas = createQRCode(text, 200);
                if (!qrCanvas) throw new Error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—');
                
                // QRã‚³ãƒ¼ãƒ‰ã®å†…éƒ¨ã‚ªãƒ•ã‚»ãƒƒãƒˆæƒ…å ±ã‚’å–å¾—
                const debugInfo = qrCanvas._debugInfo || { offsetX: 0, offsetY: 0 };
                
                // å¤§ããªç”»åƒï¼ˆèƒŒæ™¯ä»˜ãï¼‰
                const largeCanvas = document.getElementById('scenario1-large');
                const largeCtx = largeCanvas.getContext('2d');
                
                // ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’ç„¡åŠ¹åŒ–
                largeCtx.imageSmoothingEnabled = false;
                
                // ã‚·ãƒ³ãƒ—ãƒ«ãªèƒŒæ™¯ã‚’æç”»ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãªã—ï¼‰
                largeCtx.fillStyle = '#f0f0f0';
                largeCtx.fillRect(0, 0, 400, 400);
                
                // QRã‚³ãƒ¼ãƒ‰ã®å†…éƒ¨ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è€ƒæ…®ã—ã¦é…ç½®ä½ç½®ã‚’èª¿æ•´
                // å®Ÿéš›ã®QRã‚³ãƒ¼ãƒ‰ãŒ(100, 100)ã«æ¥ã‚‹ã‚ˆã†ã«èª¿æ•´
                const adjustedX = 100 - debugInfo.offsetX;
                const adjustedY = 100 - debugInfo.offsetY;
                largeCtx.drawImage(qrCanvas, adjustedX, adjustedY);
                
                console.log('QRã‚³ãƒ¼ãƒ‰é…ç½®è©³ç´°:');
                console.log('- QRã‚­ãƒ£ãƒ³ãƒã‚¹é…ç½®ä½ç½®:', adjustedX, adjustedY);
                console.log('- QRã‚³ãƒ¼ãƒ‰å†…éƒ¨ã‚ªãƒ•ã‚»ãƒƒãƒˆ:', debugInfo.offsetX, debugInfo.offsetY);
                console.log('- å®Ÿéš›ã®QRã‚³ãƒ¼ãƒ‰ä½ç½®:', adjustedX + debugInfo.offsetX, adjustedY + debugInfo.offsetY);
                
                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’è¨­å®š
                largeCanvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    document.getElementById('download-scenario1-large').href = url;
                });
                
                // å°ã•ãªç”»åƒï¼ˆQRã‚³ãƒ¼ãƒ‰ã®ã¿ï¼‰ - åŒã˜qrCanvasã‹ã‚‰åˆ‡ã‚Šå‡ºã—
                const smallCanvas = document.getElementById('scenario1-small');
                const smallCtx = smallCanvas.getContext('2d');
                
                // ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’ç„¡åŠ¹åŒ–
                smallCtx.imageSmoothingEnabled = false;
                smallCtx.clearRect(0, 0, 200, 200);
                
                // å®Œå…¨ã«åŒã˜ImageDataã‚’ä½¿ç”¨ï¼ˆãƒ”ã‚¯ã‚»ãƒ«å˜ä½ã§ã®å®Œå…¨ä¸€è‡´ã‚’ä¿è¨¼ï¼‰
                const extractedData = largeCtx.getImageData(100, 100, 200, 200);
                smallCtx.putImageData(extractedData, 0, 0);
                
                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’è¨­å®š
                smallCanvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    document.getElementById('download-scenario1-small').href = url;
                });
                
                console.log('ã‚·ãƒŠãƒªã‚ª1 ç”Ÿæˆå®Œäº†');
            } catch (error) {
                console.error('ã‚·ãƒŠãƒªã‚ª1 ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚·ãƒŠãƒªã‚ª1ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ã‚·ãƒŠãƒªã‚ª2: èƒŒæ™¯é•ã„
        function generateScenario2() {
            const text = document.getElementById('scenario2-text').value;
            
            try {
                // QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
                const qrCanvas = createQRCode(text, 150);
                if (!qrCanvas) throw new Error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—');
                
                // å¤§ããªèƒŒæ™¯
                const largeCanvas = document.getElementById('scenario2-large');
                const largeCtx = largeCanvas.getContext('2d');
                
                largeCtx.fillStyle = '#e6f3ff';
                largeCtx.fillRect(0, 0, 500, 300);
                
                largeCtx.drawImage(qrCanvas, 50, 50);
                
                largeCanvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    document.getElementById('download-scenario2-large').href = url;
                });
                
                // å°ã•ãªèƒŒæ™¯
                const smallCanvas = document.getElementById('scenario2-small');
                const smallCtx = smallCanvas.getContext('2d');
                
                smallCtx.fillStyle = '#fff2e6';
                smallCtx.fillRect(0, 0, 300, 200);
                
                smallCtx.drawImage(qrCanvas, 25, 35);
                
                smallCanvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    document.getElementById('download-scenario2-small').href = url;
                });
                
                console.log('ã‚·ãƒŠãƒªã‚ª2 ç”Ÿæˆå®Œäº†');
            } catch (error) {
                console.error('ã‚·ãƒŠãƒªã‚ª2 ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚·ãƒŠãƒªã‚ª2ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ã‚·ãƒŠãƒªã‚ª3: æ”¹ã–ã‚“æ¤œå‡º
        function generateScenario3() {
            const legitText = document.getElementById('scenario3-legit').value;
            const fakeText = document.getElementById('scenario3-fake').value;
            
            try {
                console.log('ã‚·ãƒŠãƒªã‚ª3é–‹å§‹ - æ­£å¸¸ç‰ˆ:', legitText);
                console.log('ã‚·ãƒŠãƒªã‚ª3é–‹å§‹ - æ”¹ã–ã‚“ç‰ˆ:', fakeText);
                
                // æ­£å¸¸ç‰ˆQRã‚³ãƒ¼ãƒ‰ï¼ˆå›ºå®šã‚µã‚¤ã‚ºï¼‰
                const legitQR = createQRCode(legitText, 200); // å›ºå®š200pxã‚µã‚¤ã‚º
                if (!legitQR) {
                    console.error('æ­£å¸¸ç‰ˆQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆå¤±æ•—');
                    throw new Error('æ­£å¸¸ç‰ˆQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—');
                }
                console.log('æ­£å¸¸ç‰ˆQRã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸ');
                
                const legitCanvas = document.getElementById('scenario3-legit-canvas');
                const legitCtx = legitCanvas.getContext('2d');
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
                legitCtx.clearRect(0, 0, 400, 300);
                
                // ã‚·ãƒ³ãƒ—ãƒ«ãªèƒŒæ™¯ï¼ˆæ–‡è¨€ãªã—ï¼‰
                legitCtx.fillStyle = '#f8f8f8';
                legitCtx.fillRect(0, 0, 400, 300);
                
                // QRã‚³ãƒ¼ãƒ‰ã‚’æç”»ï¼ˆä¸­å¤®é…ç½®ï¼‰
                const qrX = (400 - legitQR.width) / 2;
                const qrY = (300 - legitQR.height) / 2;
                legitCtx.drawImage(legitQR, qrX, qrY);
                
                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’è¨­å®š
                setTimeout(() => {
                    legitCanvas.toBlob((blob) => {
                        if (blob) {
                            const url = URL.createObjectURL(blob);
                            document.getElementById('download-scenario3-legit').href = url;
                            console.log('æ­£å¸¸ç‰ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®šå®Œäº†');
                        }
                    });
                }, 100);
                
                // æ”¹ã–ã‚“ç‰ˆQRã‚³ãƒ¼ãƒ‰ï¼ˆå°‘ã—é…å»¶ã•ã›ã¦ç”Ÿæˆï¼‰
                setTimeout(() => {
                    try {
                        console.log('æ”¹ã–ã‚“ç‰ˆQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆé–‹å§‹');
                        const fakeQR = createQRCode(fakeText, 200); // æ­£å¸¸ç‰ˆã¨åŒã˜200pxã‚µã‚¤ã‚º
                        if (!fakeQR) {
                            console.error('æ”¹ã–ã‚“ç‰ˆQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆå¤±æ•—');
                            throw new Error('æ”¹ã–ã‚“ç‰ˆQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—');
                        }
                        console.log('æ”¹ã–ã‚“ç‰ˆQRã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸ');
                        
                        const fakeCanvas = document.getElementById('scenario3-fake-canvas');
                        const fakeCtx = fakeCanvas.getContext('2d');
                        
                        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
                        fakeCtx.clearRect(0, 0, 250, 200);
                        
                        // ã‚·ãƒ³ãƒ—ãƒ«ãªèƒŒæ™¯ï¼ˆæ–‡è¨€ãªã—ï¼‰
                        fakeCtx.fillStyle = '#f8f8f8';
                        fakeCtx.fillRect(0, 0, 250, 200);
                        
                        // QRã‚³ãƒ¼ãƒ‰ã‚’æç”»ï¼ˆä¸­å¤®é…ç½®ï¼‰
                        const fakeQrX = (250 - fakeQR.width) / 2;
                        const fakeQrY = (200 - fakeQR.height) / 2;
                        fakeCtx.drawImage(fakeQR, fakeQrX, fakeQrY);
                        
                        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’è¨­å®š
                        setTimeout(() => {
                            fakeCanvas.toBlob((blob) => {
                                if (blob) {
                                    const url = URL.createObjectURL(blob);
                                    document.getElementById('download-scenario3-fake').href = url;
                                    console.log('æ”¹ã–ã‚“ç‰ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®šå®Œäº†');
                                }
                            });
                        }, 100);
                        
                        console.log('ã‚·ãƒŠãƒªã‚ª3 ç”Ÿæˆå®Œäº†');
                    } catch (fakeError) {
                        console.error('æ”¹ã–ã‚“ç‰ˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:', fakeError);
                        // æ”¹ã–ã‚“ç‰ˆã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚æ­£å¸¸ç‰ˆã¯è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
                        alert('æ”¹ã–ã‚“ç‰ˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + fakeError.message + '\næ­£å¸¸ç‰ˆã¯åˆ©ç”¨ã§ãã¾ã™ã€‚');
                    }
                }, 200);
                
            } catch (error) {
                console.error('ã‚·ãƒŠãƒªã‚ª3 ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚·ãƒŠãƒªã‚ª3ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // åˆæœŸç”Ÿæˆ
        window.addEventListener('load', function() {
            console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†ã€QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆé–‹å§‹...');
            
            // å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰å®Ÿè¡Œ
            setTimeout(() => {
                try {
                    generateScenario1();
                    generateScenario2();
                    generateScenario3();
                    console.log('å…¨ã‚·ãƒŠãƒªã‚ªç”Ÿæˆå®Œäº†');
                } catch (error) {
                    console.error('åˆæœŸç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                }
            }, 500);
        });
    </script>
</body>
</html>